# List all local users
Write-Host "`n[*] Local Users:" -ForegroundColor Cyan
Get-LocalUser | Select Name, Enabled, LastLogon


# Force password complexity
secedit /export /cfg C:\secpol.cfg >$null
(Get-Content C:\secpol.cfg).Replace("PasswordComplexity = 0", "PasswordComplexity = 1") | Set-Content C:\secpol.cfg
secedit /configure /db C:\Windows\security\local.sdb /cfg C:\secpol.cfg /areas SECURITYPOLICY >$null
Remove-Item C:\secpol.cfg
Write-Host "Password complexity enforced" -ForegroundColor Green

# Check for processes running from temp directories
Get-Process | Where-Object { $_.Path -like "*\Temp\*" -or $_.Path -like "*\AppData\Local\Temp\*" } | 
    Select-Object Name, Id, Path | Format-Table -AutoSize

# Block common attack ports
$portsToBlock = @(135, 139, 445, 3389, 5985, 5986)

foreach ($port in $portsToBlock) {
    New-NetFirewallRule -DisplayName "Block_Port_$port" -Direction Inbound -LocalPort $port -Protocol TCP -Action Block -ErrorAction SilentlyContinue
    Write-Host "Blocked inbound TCP port: $port" -ForegroundColor Green
}

# Block common attack ports
$portsToBlock = @(135, 139, 445, 3389, 5985, 5986)

foreach ($port in $portsToBlock) {
    New-NetFirewallRule -DisplayName "Block_Port_$port" -Direction Inbound -LocalPort $port -Protocol TCP -Action Block -ErrorAction SilentlyContinue
    Write-Host "[+] Blocked inbound TCP port: $port" -ForegroundColor Green
}
